<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Dashboard - Local Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- CSS VARIABLES & RESET --- */
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --success: #22c55e;
            --success-hover: #16a34a;
            --warning: #eab308;
            --warning-hover: #ca8a04;
            --purple: #a855f7;
            --purple-hover: #9333ea;
            --danger: #ef4444;
            --bg: #f0f4f8;
            --text-dark: #111827;
            --text-gray: #4b5563;
            --white: #ffffff;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--text-dark); line-height: 1.5; }

        /* --- LAYOUT --- */
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .hidden { display: none !important; }
        header { background: var(--white); padding: 30px; border-radius: 16px; box-shadow: var(--shadow); margin-bottom: 30px; }
        h1 { font-size: 2.5rem; font-weight: 900; margin-bottom: 15px; }
        .user-info { display: flex; gap: 20px; flex-wrap: wrap; }
        .info-tag { font-size: 0.9rem; color: var(--text-gray); }
        .info-tag span { font-weight: bold; color: var(--primary); }

        /* --- DASHBOARD GRID --- */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .btn-card { 
            padding: 25px; border: none; border-radius: 16px; color: white; font-size: 1.2rem; 
            font-weight: bold; cursor: pointer; transition: transform 0.2s, background 0.2s;
            text-align: left; box-shadow: var(--shadow);
        }
        .btn-card:hover { transform: translateY(-3px); }
        .btn-card p { font-size: 0.8rem; font-weight: normal; opacity: 0.8; margin-top: 5px; }

        .bg-indigo { background: var(--primary); }
        .bg-indigo:hover { background: var(--primary-hover); }
        .bg-green { background: var(--success); }
        .bg-green:hover { background: var(--success-hover); }
        .bg-yellow { background: var(--warning); }
        .bg-yellow:hover { background: var(--warning-hover); }
        .bg-purple { background: var(--purple); }
        .bg-purple:hover { background: var(--purple-hover); }
        .bg-gray { background: #6b7280; }

        /* --- FORMS & INPUTS --- */
        .view-card { background: var(--white); padding: 30px; border-radius: 16px; box-shadow: var(--shadow); }
        .view-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #f3f4f6; padding-bottom: 15px; margin-bottom: 20px; }
        
        input, select, textarea { 
            width: 100%; padding: 12px; margin-top: 8px; border: 1px solid #d1d5db; 
            border-radius: 10px; font-size: 1rem;
        }
        label { font-weight: bold; font-size: 0.9rem; color: var(--text-gray); }
        .form-group { margin-bottom: 20px; }

        .submit-btn { 
            width: 100%; padding: 15px; border-radius: 12px; border: none; color: white; 
            font-weight: bold; font-size: 1.1rem; cursor: pointer; margin-top: 10px;
        }

        /* --- UTILS --- */
        .equipment-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 15px; }
        .option-box { background: #f9fafb; padding: 15px; border-radius: 12px; border: 1px solid #e5e7eb; }
        .checkbox-item { display: flex; align-items: center; gap: 10px; font-size: 0.85rem; margin-bottom: 5px; }
        .checkbox-item input { width: auto; margin: 0; }

        /* --- MODALS --- */
        .modal-overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.7); 
            display: flex; align-items: center; justify-content: center; z-index: 100;
        }
        .modal-content { 
            background: white; width: 90%; max-width: 600px; max-height: 80vh; 
            overflow-y: auto; border-radius: 20px; padding: 25px; 
        }

        /* --- MESSAGE BOX --- */
        #message-box {
            position: fixed; top: 20px; right: 20px; padding: 15px 25px; 
            border-radius: 8px; color: white; font-weight: bold; z-index: 1000;
            transition: opacity 0.3s;
        }

        /* --- TRACKING ROWS --- */
        .set-row { display: grid; grid-template-columns: 1fr 2fr 2fr; gap: 10px; align-items: center; margin-bottom: 10px; padding: 10px; background: #f3f4f6; border-radius: 8px; }
        .logged-item { border-left: 5px solid var(--success); background: #f0fdf4; padding: 15px; border-radius: 8px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div id="message-box" class="hidden"></div>

    <div id="view-dashboard" class="view">
        <header>
            <h1>Integrated Fitness</h1>
            <div class="user-info">
                <div class="info-tag">Name: <span id="user-name-display">Guest User</span></div>
                <div class="info-tag">Goal: <span id="user-goal-display">Maintenance</span></div>
            </div>
        </header>

        <div class="grid">
            <button class="btn-card bg-indigo" onclick="showView('gym-config')">
                <i class="fas fa-dumbbell"></i> Configure Gym
                <p id="gym-status">Loading equipment...</p>
            </button>
            <button class="btn-card bg-green" onclick="showView('plan-workout')">
                <i class="fas fa-running"></i> Plan Workout
            </button>
            <button class="btn-card bg-yellow" onclick="showView('meal-log')">
                <i class="fas fa-utensils"></i> Log Meal
            </button>
            <button class="btn-card bg-purple" onclick="showView('body-metrics')">
                <i class="fas fa-ruler"></i> Body Metrics
            </button>
            <button class="btn-card bg-gray" id="view-history-btn">
                <i class="fas fa-chart-line"></i> View History
            </button>
        </div>
        
        <div style="text-align: center; margin-top: 40px;">
            <button onclick="resetAppData()" style="color: var(--danger); background: none; border: none; text-decoration: underline; cursor: pointer;">
                Reset All Local Data
            </button>
        </div>
    </div>

    <div id="view-gym-config" class="view-card hidden">
        <div class="view-header">
            <h2>Gym Configuration</h2>
            <button onclick="showView('dashboard')">Back</button>
        </div>
        <form id="gym-setup-form">
            <div class="form-group">
                <label>Gym Name</label>
                <input type="text" id="gym-name-input" value="My Local Gym">
            </div>
            <div class="equipment-grid">
                <div class="option-box">
                    <h3>Weights</h3>
                    <div id="weights-options"></div>
                </div>
                <div class="option-box">
                    <h3>Cardio</h3>
                    <div id="cardio-options"></div>
                </div>
                <div class="option-box">
                    <h3>Floor</h3>
                    <div id="floor-options"></div>
                </div>
            </div>
            <button type="submit" class="submit-btn bg-indigo">Save Configuration</button>
        </form>
    </div>

    <div id="view-meal-log" class="view-card hidden">
        <div class="view-header">
            <h2>Log Meal</h2>
            <button onclick="showView('dashboard')">Back</button>
        </div>
        <form id="meal-form">
            <input type="text" id="meal-name" placeholder="Meal Name" required>
            <textarea id="meal-details" placeholder="Details (Calories, protein, etc)"></textarea>
            <button type="submit" class="submit-btn bg-yellow">Log Meal</button>
        </form>
        <div id="todays-meals" style="margin-top: 20px;"></div>
    </div>

    <div id="view-plan-workout" class="view-card hidden">
        <div class="view-header">
            <h2>Start Workout</h2>
            <button onclick="showView('dashboard')">Back</button>
        </div>
        <form id="plan-form">
            <div class="form-group">
                <label>Focus</label>
                <select id="workout-focus"></select>
            </div>
            <button type="submit" class="submit-btn bg-green">Start Session</button>
        </form>
    </div>

    <div id="view-track-workout" class="view-card hidden">
        <div class="view-header">
            <h2 id="active-workout-title">Active Session</h2>
            <button onclick="finishWorkout()">Finish</button>
        </div>
        
        <div id="exercise-adder" class="option-box" style="margin-bottom: 20px;">
            <label>Select Exercise</label>
            <select id="exercise-select"></select>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <input type="number" id="input-sets" value="3" placeholder="Sets">
                <input type="number" id="input-reps" value="10" placeholder="Reps">
            </div>
            <button onclick="startTrackingExercise()" class="submit-btn bg-indigo" style="padding: 10px;">Setup Sets</button>
        </div>

        <div id="active-sets-area"></div>
        <div id="logged-exercises-list"></div>
    </div>

    <div id="view-body-metrics" class="view-card hidden">
        <div class="view-header">
            <h2>Body Progress</h2>
            <button onclick="showView('dashboard')">Back</button>
        </div>
        <form id="metrics-form" class="option-box">
            <div style="display: flex; gap: 10px;">
                <input type="number" id="metric-weight" step="0.1" placeholder="Weight (kg)">
                <button type="submit" class="submit-btn bg-purple" style="margin: 0; width: auto;">Log</button>
            </div>
        </form>
        <div id="metrics-history" style="margin-top: 20px;"></div>
    </div>

    <div id="history-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="view-header">
                <h2>Workout History</h2>
                <button onclick="closeModal()">Close</button>
            </div>
            <div id="history-list"></div>
            <div id="chart-section" class="hidden">
                <canvas id="historyChart" style="height: 250px;"></canvas>
            </div>
        </div>
    </div>

</div>

<script>
    /* --- DATA DEFAULTS --- */
    const EQUIPMENT_MAP = {
        weights: ["barbell", "dumbbell", "machines", "cables", "smith machine"],
        cardio: ["treadmill", "bike", "rower", "elliptical"],
        floor: ["TRX", "bands", "floor", "medicine ball"]
    };

    const FOCUS_OPTIONS = ["Full Body", "Upper Body", "Lower Body", "Push", "Pull", "Legs"];

    const EXERCISE_LIBRARY = [
        { name: "Bench Press", equipment: ["barbell", "machines"], focus: ["Upper Body", "Push"] },
        { name: "Dumbbell Press", equipment: ["dumbbell"], focus: ["Upper Body", "Push"] },
        { name: "Squat", equipment: ["barbell", "machines"], focus: ["Lower Body", "Legs"] },
        { name: "Deadlift", equipment: ["barbell"], focus: ["Lower Body", "Full Body"] },
        { name: "Lat Pulldown", equipment: ["machines", "cables"], focus: ["Upper Body", "Pull"] },
        { name: "Bicep Curls", equipment: ["dumbbell", "barbell", "cables"], focus: ["Upper Body", "Pull"] },
        { name: "Treadmill Run", equipment: ["treadmill"], focus: ["Full Body"] }
    ];

    /* --- APP STATE & LOCAL STORAGE --- */
    let state = JSON.parse(localStorage.getItem('fitnessAppState')) || {
        userName: "Local User",
        goal: "Strength",
        gymName: "My Local Gym",
        gymSetup: { weights: ["barbell", "dumbbell"], cardio: ["treadmill"], floor: ["floor"] },
        workoutLog: [],
        mealLog: [],
        metrics: [],
        exerciseHistory: {}
    };

    let currentSession = null;
    let chartInstance = null;

    function saveState() {
        localStorage.setItem('fitnessAppState', JSON.stringify(state));
        updateDashboardUI();
    }

    /* --- NAVIGATION --- */
    function showView(viewId) {
        document.querySelectorAll('.view, .view-card').forEach(v => v.classList.add('hidden'));
        document.getElementById(`view-${viewId}`).classList.remove('hidden');
        
        if(viewId === 'gym-config') renderGymConfig();
        if(viewId === 'plan-workout') renderWorkoutPlanner();
        if(viewId === 'meal-log') renderMeals();
        if(viewId === 'body-metrics') renderMetrics();
    }

    /* --- UTILITIES --- */
    function showMsg(text, type='success') {
        const box = document.getElementById('message-box');
        box.textContent = text;
        box.style.background = type === 'success' ? 'var(--success)' : 'var(--danger)';
        box.classList.remove('hidden');
        setTimeout(() => box.classList.add('hidden'), 3000);
    }

    /* --- GYM CONFIG LOGIC --- */
    function renderGymConfig() {
        const renderOpts = (id, key) => {
            const container = document.getElementById(id);
            container.innerHTML = EQUIPMENT_MAP[key].map(item => `
                <div class="checkbox-item">
                    <input type="checkbox" name="${key}" value="${item}" ${state.gymSetup[key].includes(item) ? 'checked' : ''}>
                    ${item}
                </div>
            `).join('');
        };
        renderOpts('weights-options', 'weights');
        renderOpts('cardio-options', 'cardio');
        renderOpts('floor-options', 'floor');
        document.getElementById('gym-name-input').value = state.gymName;
    }

    document.getElementById('gym-setup-form').onsubmit = (e) => {
        e.preventDefault();
        state.gymName = document.getElementById('gym-name-input').value;
        ['weights', 'cardio', 'floor'].forEach(key => {
            state.gymSetup[key] = Array.from(document.querySelectorAll(`input[name="${key}"]:checked`)).map(i => i.value);
        });
        saveState();
        showMsg("Gym Setup Saved!");
        showView('dashboard');
    };

    /* --- MEAL LOGIC --- */
    document.getElementById('meal-form').onsubmit = (e) => {
        e.preventDefault();
        const meal = {
            name: document.getElementById('meal-name').value,
            details: document.getElementById('meal-details').value,
            date: new Date().toLocaleDateString()
        };
        state.mealLog.push(meal);
        saveState();
        renderMeals();
        e.target.reset();
        showMsg("Meal Logged!");
    };

    function renderMeals() {
        const container = document.getElementById('todays-meals');
        const today = new Date().toLocaleDateString();
        const meals = state.mealLog.filter(m => m.date === today);
        container.innerHTML = `<h3>Today's Meals</h3>` + meals.map(m => `
            <div class="logged-item" style="border-left-color: var(--warning)">
                <strong>${m.name}</strong><br><small>${m.details}</small>
            </div>
        `).join('');
    }

    /* --- WORKOUT LOGIC --- */
    function renderWorkoutPlanner() {
        const sel = document.getElementById('workout-focus');
        sel.innerHTML = FOCUS_OPTIONS.map(f => `<option value="${f}">${f}</option>`).join('');
    }

    document.getElementById('plan-form').onsubmit = (e) => {
        e.preventDefault();
        const focus = document.getElementById('workout-focus').value;
        currentSession = { title: focus, date: new Date().toISOString(), exercises: [] };
        
        // Filter exercises by equipment
        const myEquip = [...state.gymSetup.weights, ...state.gymSetup.cardio, ...state.gymSetup.floor];
        const filtered = EXERCISE_LIBRARY.filter(ex => ex.equipment.some(e => myEquip.includes(e)));
        
        document.getElementById('exercise-select').innerHTML = filtered.map(ex => `<option value="${ex.name}">${ex.name}</option>`).join('');
        document.getElementById('active-workout-title').textContent = focus + " Session";
        showView('track-workout');
    };

    function startTrackingExercise() {
        const name = document.getElementById('exercise-select').value;
        const setsCount = parseInt(document.getElementById('input-sets').value);
        const repsCount = parseInt(document.getElementById('input-reps').value);

        let html = `<h4>Tracking: ${name}</h4>`;
        for(let i=1; i<=setsCount; i++) {
            html += `
                <div class="set-row" data-ex="${name}">
                    <span>Set ${i}</span>
                    <input type="number" class="set-reps" value="${repsCount}" placeholder="Reps">
                    <input type="number" class="set-weight" placeholder="kg">
                </div>
            `;
        }
        html += `<button onclick="logExerciseToSession('${name}')" class="submit-btn bg-indigo">Save Exercise</button>`;
        document.getElementById('active-sets-area').innerHTML = html;
    }

    function logExerciseToSession(name) {
        const rows = document.querySelectorAll(`.set-row[data-ex="${name}"]`);
        const setsData = Array.from(rows).map(r => ({
            reps: parseFloat(r.querySelector('.set-reps').value) || 0,
            weight: parseFloat(r.querySelector('.set-weight').value) || 0
        }));

        currentSession.exercises.push({ name, sets: setsData });
        
        // Update Personal Bests
        const maxW = Math.max(...setsData.map(s => s.weight));
        if(!state.exerciseHistory[name] || maxW > state.exerciseHistory[name]) {
            state.exerciseHistory[name] = maxW;
        }

        document.getElementById('active-sets-area').innerHTML = "";
        renderLoggedSession();
        showMsg(`${name} Logged`);
    }

    function renderLoggedSession() {
        document.getElementById('logged-exercises-list').innerHTML = `<h3>Logged:</h3>` + 
            currentSession.exercises.map(ex => `<div class="logged-item">${ex.name} - ${ex.sets.length} sets</div>`).join('');
    }

    function finishWorkout() {
        if(currentSession.exercises.length > 0) {
            state.workoutLog.push(currentSession);
            saveState();
            showMsg("Workout Saved to Local Storage!");
        }
        currentSession = null;
        showView('dashboard');
    }

    /* --- METRICS --- */
    document.getElementById('metrics-form').onsubmit = (e) => {
        e.preventDefault();
        const weight = document.getElementById('metric-weight').value;
        if(!weight) return;
        state.metrics.push({ weight: parseFloat(weight), date: new Date().toLocaleDateString() });
        saveState();
        renderMetrics();
        e.target.reset();
    };

    function renderMetrics() {
        const container = document.getElementById('metrics-history');
        container.innerHTML = state.metrics.slice().reverse().map(m => `
            <div class="logged-item" style="border-left-color: var(--purple)">
                <strong>${m.weight} kg</strong> - ${m.date}
            </div>
        `).join('');
    }

    /* --- HISTORY & CHARTING --- */
    document.getElementById('view-history-btn').onclick = () => {
        document.getElementById('history-modal').classList.remove('hidden');
        renderHistoryList();
    };

    function closeModal() { document.getElementById('history-modal').classList.add('hidden'); }

    function renderHistoryList() {
        const list = document.getElementById('history-list');
        if(state.workoutLog.length === 0) {
            list.innerHTML = "<p>No workouts recorded yet.</p>";
            return;
        }
        list.innerHTML = state.workoutLog.slice().reverse().map((w, idx) => `
            <div class="logged-item">
                <strong>${w.title}</strong> (${new Date(w.date).toLocaleDateString()})
                <br>${w.exercises.length} exercises logged.
            </div>
        `).join('');
    }

    /* --- APP INIT --- */
    function updateDashboardUI() {
        document.getElementById('user-name-display').textContent = state.userName;
        document.getElementById('user-goal-display').textContent = state.goal;
        document.getElementById('gym-status').textContent = state.gymName + " | " + 
            (state.gymSetup.weights.length + state.gymSetup.cardio.length + state.gymSetup.floor.length) + " items";
    }

    function resetAppData() {
        if(confirm("Are you sure? This will wipe your local history.")) {
            localStorage.removeItem('fitnessAppState');
            location.reload();
        }
    }

    window.onload = updateDashboardUI;
</script>

</body>
</html>
