<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Fitness Tracker</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind to use Inter font and simple theme -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#059669', // Emerald 600
                        'primary-dark': '#047857', // Emerald 700
                        'secondary': '#f97316', // Orange 600
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom styles for mobile-first design */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Gray 100 */
        }
        .app-container {
            max-width: 420px; /* Max width for mobile aesthetic */
            min-height: 100vh;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .action-button {
            transition: all 0.2s;
        }
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="flex justify-center">
    <div id="app" class="app-container bg-white flex flex-col">
        <!-- Header -->
        <header class="bg-primary text-white p-4 shadow-lg sticky top-0 z-10">
            <h1 class="text-2xl font-bold text-center">My Progress Hub</h1>
        </header>

        <!-- Main Content View -->
        <main id="content-view" class="flex-grow p-4 overflow-y-auto">
            <!-- Content will be rendered here by JavaScript -->
        </main>

        <!-- Action Buttons Footer -->
        <footer class="bg-white border-t border-gray-200 p-3 shadow-2xl sticky bottom-0 z-10">
            <div id="action-buttons" class="flex justify-around">
                <!-- Buttons are rendered by JS -->
            </div>
        </footer>
    </div>

    <!-- Firebase Imports and Setup -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, query, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        setLogLevel('Debug');

        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db = null;
        let auth = null;
        let userId = null;

        // Initialize Firebase
        if (Object.keys(firebaseConfig).length > 0) {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            // Authentication
            const setupAuth = async () => {
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (error) {
                    console.error("Firebase Auth failed:", error);
                }
            };

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    userId = user.uid;
                    console.log("User authenticated:", userId);
                    // Start fetching data or rendering initial view after auth
                    initApp();
                } else {
                    userId = null;
                    console.log("User signed out or failed to authenticate.");
                    initApp(); // Fallback for rendering, although data fetching will fail without auth
                }
            });

            setupAuth();
        } else {
            console.warn("Firebase config not available. Running in local mode.");
            initApp();
        }

        // --- Application State and Logic ---
        let currentView = 'home';
        let measurementsData = []; // State for measurements

        const VIEWS = {
            'home': { name: 'Home', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>` },
            'workouts': { name: 'Workouts', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M8 17h8"/><path d="M8 13h8"/></svg>` },
            'meal-plans': { name: 'Meal Plans', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/></svg>` },
            'measurements': { name: 'Measurements', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><path d="M4 15V9a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v6"/><path d="M15 11l-3 3-3-3"/></svg>` }
        };

        const BODY_PARTS = [
            'Shoulders', 'Chest', 'Lats', 'Torso', 'Hips', 'Glutes',
            'Biceps L & R', 'Triceps L & R', 'Upper Legs L & R', 'Calves L & R'
        ];

        // Function to change the view
        window.setView = (view) => {
            currentView = view;
            renderApp();
        };

        // --- View Rendering Functions ---

        const renderHomeView = () => {
            return `
                <div class="space-y-6">
                    <div class="bg-primary-dark text-white p-6 rounded-xl shadow-lg">
                        <h2 class="text-xl font-semibold mb-2">Welcome Back!</h2>
                        <p>Track your fitness journey. Navigate using the buttons below.</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white p-4 rounded-xl shadow-md border-l-4 border-primary">
                            <p class="font-medium text-lg">Workouts Log</p>
                            <p class="text-gray-500 text-sm">Review your session history.</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-md border-l-4 border-secondary">
                            <p class="font-medium text-lg">Meal Summary</p>
                            <p class="text-gray-500 text-sm">Check your calorie intake.</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-md border-l-4 border-blue-500">
                            <p class="font-medium text-lg">Body Progress</p>
                            <p class="text-gray-500 text-sm">View measurement changes.</p>
                        </div>
                    </div>
                    
                    ${userId ? `<p class="text-xs text-center text-gray-400 mt-4">User ID: ${userId}</p>` : ''}
                </div>
            `;
        };

        const renderPlaceholderView = (title) => {
            return `
                <div class="p-6 bg-white rounded-xl shadow-lg text-center">
                    <h2 class="text-2xl font-bold text-primary mb-4">${title}</h2>
                    <p class="text-gray-600">This area is under development.</p>
                    <p class="text-sm mt-2">You can implement your specific logic for ${title.toLowerCase()} tracking here, including Firestore integration using the available <code class="bg-gray-200 p-1 rounded">db</code> and <code class="bg-gray-200 p-1 rounded">userId</code> variables.</p>
                </div>
            `;
        };

        const renderMeasurementsView = () => {
            const today = new Date().toISOString().split('T')[0];

            return `
                <div class="space-y-8">
                    <h2 class="text-2xl font-bold text-primary border-b pb-2 mb-6">Body Measurements Log</h2>

                    <!-- Photo Log Section -->
                    <div class="bg-white p-5 rounded-xl shadow-md border-t-4 border-blue-500">
                        <h3 class="text-xl font-semibold mb-3 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3z"/><circle cx="12" cy="13" r="3"/></svg>
                            Progress Photos
                        </h3>
                        <input type="file" id="photo-upload" accept="image/*" multiple class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-primary-dark cursor-pointer">
                        <p class="text-xs text-gray-500 mt-2">Select one or more photos to track visual progress.</p>
                        <div id="photo-preview" class="grid grid-cols-2 gap-2 mt-4">
                            <!-- Image previews will appear here -->
                        </div>
                    </div>

                    <!-- Measurement Input Section -->
                    <div class="bg-white p-5 rounded-xl shadow-md border-t-4 border-secondary">
                        <h3 class="text-xl font-semibold mb-3 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M12 2H2v10l10 10 10-10L12 2zM7 9a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></svg>
                            Add New Measurements
                        </h3>
                        <form id="measurement-form" class="space-y-4">
                            <div>
                                <label for="date-input" class="block text-sm font-medium text-gray-700">Date</label>
                                <input type="date" id="date-input" value="${today}" max="${today}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary p-2 border">
                            </div>

                            <div>
                                <label for="body-part-select" class="block text-sm font-medium text-gray-700">Body Part</label>
                                <select id="body-part-select" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary p-2 border bg-white">
                                    <option value="">-- Select Measurement --</option>
                                    ${BODY_PARTS.map(part => `<option value="${part}">${part}</option>`).join('')}
                                </select>
                            </div>

                            <div id="measurement-inputs" class="space-y-3 p-3 bg-gray-50 rounded-lg">
                                <!-- Dynamic inputs will be added here -->
                                <p class="text-sm text-gray-500 italic">Select a body part above to enter the size (e.g., in inches or cm).</p>
                            </div>

                            <button type="submit" class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-secondary hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary transition duration-150">
                                Save Measurement
                            </button>
                        </form>
                    </div>

                    <!-- Measurement History (Simple Log) -->
                    <div class="bg-white p-5 rounded-xl shadow-md">
                        <h3 class="text-xl font-semibold mb-3">Measurement History</h3>
                        <div id="history-log" class="space-y-2">
                            ${measurementsData.length === 0 ? '<p class="text-gray-500 italic">No measurements logged yet.</p>' : measurementsData.map(log => `
                                <div class="p-3 bg-gray-100 rounded-lg border-l-4 border-primary-dark">
                                    <p class="font-medium text-sm">${log.date} - ${log.part}</p>
                                    ${Object.keys(log.values).map(key => `<span class="inline-block text-xs mr-3">${key}: <span class="font-bold">${log.values[key]}</span></span>`).join('')}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        };

        // --- Core Application Loop ---

        const renderActionButtons = () => {
            const container = document.getElementById('action-buttons');
            container.innerHTML = Object.keys(VIEWS).map(key => {
                const view = VIEWS[key];
                const isActive = key === currentView;
                const baseClasses = "flex flex-col items-center justify-center p-2 rounded-xl action-button text-sm font-medium transition duration-200";
                const activeClasses = "text-primary bg-primary/10 shadow-md";
                const inactiveClasses = "text-gray-500 hover:text-primary hover:bg-gray-100";

                return `
                    <button onclick="setView('${key}')" class="${baseClasses} ${isActive ? activeClasses : inactiveClasses}">
                        ${view.icon}
                        <span class="mt-1">${view.name}</span>
                    </button>
                `;
            }).join('');
        };

        const renderApp = () => {
            renderActionButtons();
            const contentView = document.getElementById('content-view');

            switch (currentView) {
                case 'workouts':
                    contentView.innerHTML = renderPlaceholderView('Workouts Tracker');
                    break;
                case 'meal-plans':
                    contentView.innerHTML = renderPlaceholderView('Meal Plans Manager');
                    break;
                case 'measurements':
                    contentView.innerHTML = renderMeasurementsView();
                    // Setup listeners for the measurements view after rendering
                    setupMeasurementsListeners();
                    break;
                case 'home':
                default:
                    contentView.innerHTML = renderHomeView();
            }
        };

        // --- Measurements Specific Logic ---

        const setupMeasurementsListeners = () => {
            const selectElement = document.getElementById('body-part-select');
            const inputsContainer = document.getElementById('measurement-inputs');
            const form = document.getElementById('measurement-form');
            const photoUpload = document.getElementById('photo-upload');
            const photoPreview = document.getElementById('photo-preview');

            // 1. Dynamic Input Generation
            selectElement.onchange = () => {
                const selectedPart = selectElement.value;
                inputsContainer.innerHTML = '';
                if (!selectedPart) {
                    inputsContainer.innerHTML = '<p class="text-sm text-gray-500 italic">Select a body part above to enter the size (e.g., in inches or cm).</p>';
                    return;
                }

                if (selectedPart.includes('L & R')) {
                    const basePart = selectedPart.replace(' L & R', '');
                    inputsContainer.innerHTML = `
                        <div>
                            <label for="input-left" class="block text-sm font-medium text-gray-700">${basePart} - Left (cm/in)</label>
                            <input type="number" step="0.1" id="input-left" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary p-2 border">
                        </div>
                        <div>
                            <label for="input-right" class="block text-sm font-medium text-gray-700">${basePart} - Right (cm/in)</label>
                            <input type="number" step="0.1" id="input-right" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary p-2 border">
                        </div>
                    `;
                } else {
                    inputsContainer.innerHTML = `
                        <div>
                            <label for="input-single" class="block text-sm font-medium text-gray-700">${selectedPart} (cm/in)</label>
                            <input type="number" step="0.1" id="input-single" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary p-2 border">
                        </div>
                    `;
                }
            };

            // 2. Form Submission (Data Logging)
            form.onsubmit = (e) => {
                e.preventDefault();
                const part = selectElement.value;
                const date = document.getElementById('date-input').value;
                let values = {};
                let isValid = false;

                if (part.includes('L & R')) {
                    const left = document.getElementById('input-left').value;
                    const right = document.getElementById('input-right').value;
                    if (left && right) {
                        values['Left'] = left;
                        values['Right'] = right;
                        isValid = true;
                    }
                } else if (part) {
                    const single = document.getElementById('input-single').value;
                    if (single) {
                        values[part] = single;
                        isValid = true;
                    }
                }

                if (isValid) {
                    const newLog = { date, part, values };
                    // In a real app, you would save this to Firestore here
                    // For now, update client-side state and re-render
                    measurementsData.unshift(newLog); // Add to the beginning
                    console.log("Measurement Logged:", newLog);
                    renderApp(); // Re-render to update the history log
                } else {
                    console.error("Please enter a value for the selected body part.");
                    // You would show a user-friendly message here instead of alert/console.error
                }
            };

            // 3. Photo Preview Handling
            photoUpload.onchange = (e) => {
                photoPreview.innerHTML = '';
                const files = e.target.files;

                if (files.length > 0) {
                    Array.from(files).forEach(file => {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            const imgContainer = document.createElement('div');
                            imgContainer.className = 'w-full h-32 bg-gray-200 rounded-lg overflow-hidden';
                            imgContainer.innerHTML = `<img src="${event.target.result}" alt="Progress Photo" class="w-full h-full object-cover">`;
                            photoPreview.appendChild(imgContainer);
                        };
                        reader.readAsDataURL(file);
                    });
                }
            };
        };

        // Initial app launch
        const initApp = () => {
            renderApp();
            // Note: Data fetching/Firestore setup would typically go here using onSnapshot
        };
    </script>
</body>
</html>

